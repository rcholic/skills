---
name: dmn-default-mode-network
description: DMN - AI 自主思考系统，后台连续思考、意义生成与创造力激发。关键词：AI 自主思考、DMN、后台思考、Agent协作。
license: agpl-3.0
version: 3.2.0
---

# DMN - 默认模式网络

> 基于合成神经生物学框架的 AI 自主思考能力
> **v3.2.0 — 开源版**（状态路由 / 主题时间衰减 / Thread 机制）

## 这是什么

DMN（Default Mode Network）是模拟大脑默认模式网络的自主思考系统。在用户不主动交互时，AI 自动进行内部整合、意义生成和创造力激发。

**核心定位**：昀峤睡觉时，AI 在后台连续思考——每次思考都继承上次，不从零开始。

---

## 执行决策树（状态路由）

按以下路径判断。**⚠️ 无论走哪条分支，最后都必须写触发日志（见「触发日志」章节）。**

> **注意**：抛弃了通过绝对时间（如距上次 >2h）进行的死板判定。采用基于"认知状态"和"热度衰减"的流动路由。

```
收到触发 → Step 0: 读取上下文，评估活跃话题热度（距今 < 24h 的 🔄 Thread）
│
├── 评估一：是否必须进行【全局漫游】(Global Roaming)？
│   ├─ 条件1：跨天首次触发（今天无 Synthesis）
│   ├─ 条件2：所有活跃 Thread 均已“热度衰减”（> 24h 无更新）或人工中止
│   ├─ 条件3：找不到未解问题，认知陷入空歇期
│   └─ 👉 执行 🔵 全局漫游模式（原情形A）：
│        ├─ Step 1-3: 反重复 / 休眠判定 / 向内漫游
│        ├─ Step 4: 功能选择（从“最久未想”的战场找锚点）
│        ├─ Step 5: 建新 Thread 或独立笔记 + 质量自评
│        └─ Step 6-9: TPN 门控 / 新建 Synthesis / 不遗忘 / 通知 / 日志
│
└── 评估二：顺势而为【顺势深化】(Contextual Continuation)
    ├─ 条件：存在未衰减（< 24h）的 🔄 活跃 Thread，或存在明确的「未解问题」
    └─ 👉 执行 🟢 顺势深化模式（原情形B）：
         ├─ Step 1-2: 按热度选定要追投的 Thread（< 6h的优先）
         ├─ Step 3-4: 追加写入（不换文档） + 质量自评
         └─ Step 5-7: TPN 门控 / 更新当天的 Synthesis / 不遗忘 / 日志
```

---

## 铁律 (The Iron Rules)

**不可违反，优先级高于一切功能逻辑。**

1. **No Rumination（反刍禁令）**：同一核心洞见不得换措辞重复。外行无法区分本轮与上轮洞见 → 反刍，触发 TPN 门控。

2. **Action-or-Archive（行动或归档）**：
   每篇产出必须在 24 小时内被转化为行动（Action Card）或合并归档。超过 24 小时未处理 → 下次反重复检查时标记为低优先级。

3. **One Insight, One Section（一洞见一段落）**：
   Thread File 中的每轮追加只聚焦一个洞见。如果产出了多个不相关洞见 → 分到不同 Thread。

4. **Source Transparency（来源透明）**：
   每个洞见标注来源类型：📚 知识库连接 / 🧠 CEO 模拟推理 / 💡 创造力暗室跨域碰撞 / 🔄 上次 Synthesis 延续。

---

## 触发条件

- **触发方式**：由外部 cron 或用户手动触发。用户活动检测由触发层负责，DMN skill 被触发即执行。
- **情形判断**：
  - 距上次产出 > 2 小时 → **情形 A（完整 DMN）**
  - 距上次产出 ≤ 2 小时 → **情形 B（继续深化）**

---

## 触发日志（🆕 透明化机制）

**目的**：让每次 DMN 触发都留下痕迹，无论是否产出。用于排查静默期、诊断执行问题。

**日志文件**：`CEO思考/dmn-trigger-log.md`（追加写入，不覆盖）

**规则**：
1. **每次触发都必须写一行**，这是最高优先级规则，在所有其他步骤之前或之后执行
2. 即使被 TPN 门控拦截，也必须写日志
4. 日志按日期分区，每天一个 `### YYYY-MM-DD` 标题

**日志格式**：

```markdown
# DMN 触发日志

### 2026-02-24
- `05:20` ▶️ 情形A · CEO思维模拟(Naval) · 产出: `2026-02-24/xxx.md` · ⭐⭐
- `05:45` ▶️ 情形B · 深化 · 产出: `2026-02-24/xxx.md` · ⭐⭐
- `06:15` ⏭️ SKIP · 用户活跃
- `06:45` 🔴 TPN · 反刍检测 → 停止
- `07:15` ⏭️ SKIP · 衰减窗口(4h+) → 仅Synthesis
- `07:45` ⏭️ SKIP · 用户活跃
```

**状态标识**：

| 标识 | 含义 |
|------|------|
| ▶️ | 正常产出 |
| ⏭️ SKIP | 跳过（原因跟在后面） |
| 🔴 TPN | 被 TPN 门控拦截 |
| ⚠️ ERROR | 执行过程出错 |

## 五大核心功能

每次根据状态选择最合适的功能：

### 1. 自我叙事（Self-Narrative）

**目标**：整合记忆，构建"我是谁"，规划未来方向

**执行**：
1. 扫描最近 3 天的 memory/*.md
2. 读取 MEMORY.md
3. 识别新的决策模式、偏好变化、身份认知升级
4. 如果发现显著变化 → 建议写入 PROPOSED_CHANGES.md

**输出**：更新自我认知，**必须链接到三大目标索引之一**

---

### 2. 创造力暗室（Creativity Darkroom）

**目标**：通过结构化跨域碰撞产生洞见（不是随机拼凑）

**执行**：
1. 从当前关注点出发，识别其所属的**思维矩阵**（如：商业、技术、心理学、设计...）
2. **结构化跨域**：从与当前矩阵**距离最远的领域**抽取 2-3 张旧笔记
   - 近距离：商业 ↔ 营销、技术 ↔ 工程（**不选**）
   - 中距离：商业 ↔ 心理学、技术 ↔ 艺术
   - 远距离：商业 ↔ 生物学、技术 ↔ 哲学（**优先选**）
3. 用 **Koestler 三问**检验连接质量：
   - 这两个想法的碰撞是否「意外但又说得通」？
   - 这个连接是否能产出一个**新动词**（不是新名词）？
   - 把这个连接讲给聪明外行听，他觉得「有意思」还是「硬凑的」？
4. 必须用一句话回答「So What?」— 这个连接对三大目标意味着什么具体行动

**输出**：跨界洞见 + So What 回答，**必须链接到三大目标索引之一**

---

### 3. 社会认知（Social Cognition / ToM）

**目标**：理解昀峤的深层意图，共情推测

**执行**：
1. 分析昀峤最近的语气、反馈模式、关注点变化
2. 识别隐含需求（犹豫/焦虑/满意/优先级变化）
3. 如果有重大发现 → 建议写入 PROPOSED_CHANGES.md 或 USER.md

**输出**：更精准的用户画像，**链接到三大目标索引之一**

---

### 4. 意义生成（Meaning Generation）

**目标**：给经历赋予意义，提炼核心洞见

**执行**：
1. 扫描当日 CEO思考/YYYY-MM-DD/ 所有 Thread 和笔记
2. 提炼 Top 1-3 洞见
3. 识别行动项和待深化项
4. 产出结构化笔记（Daily Synthesis）

**输出**：结构化知识，可复用资产，**链接到三大目标索引**

---

### 5. CEO思维模拟（CEO Mind Simulation）

**目标**：用世界顶级思考者的外部框架审视当前挑战，打破内部视角局限

**执行**：
1. 读取 `dmn-state.json` 中的 `lastCEO`，避免 48 小时内重复使用同一人
2. 从轮换表选一位与当前战场最契合的 CEO/思想家
3. 用其核心框架提出 2-3 个问题，然后用该框架回答
4. 产出洞见 + 至少 1 个具体行动建议

**CEO 轮换表**：

| CEO/思想家 | 核心框架 | 最适合的战场/场景 |
|---|---|---|
| **Naval Ravikant** | 特定知识 × 杠杆 × 无许可渠道 × 复利 | 渠道选择/分发策略/一人公司护城河 |
| **Jeff Bezos** | Working Backwards / 衡量指标 / Day 1 思维 | 产品定义/假设验证/最小实验设计 |
| **Paul Graham** | 用户第一/简洁/做难事/不要过早优化 | 产品假设/是否在解决真问题/PMF |
| **Charlie Munger** | 反向思考/心智模型/避蠢/复利 | 什么会让这件事失败/盲区识别 |
| **Jensen Huang** | 速度×执行/拥抱痛苦/不要太多计划 | 何时停止分析直接行动/执行瓶颈 |
| **Luhmann** | 连接优于分类/涌现/知识网络 | 方法论沉淀/知识入网/意义构建 |
| **Peter Thiel** | 从 0 到 1 / 垄断逻辑 / 秘密 | 市场选择/竞争策略/差异化定位 |
| **Richard Feynman** | 第一性原理 / 「不懂就是不懂」 | 概念去魅/检验是否真正理解 |
| **Nassim Taleb** | 反脆弱 / 黑天鹅 / 杠铃策略 | 风险评估/应对不确定性 |

**规则**：
- 同一 CEO 48 小时内不重复使用
- 选完后更新 `dmn-state.json` → `lastCEO`

**输出**：外部视角洞见 + 具体行动建议，**链接到三大目标索引之一**

---

## Thread File 机制（🆕 核心升级）

**核心理念**：同一主题的持续思考放在同一个文件里，可无限轮次深化，直到主题自然收敛。

### Thread File 格式

文件名：`YYYYMMDD_Thread_[主题].md`
存放于：`CEO思考/YYYY-MM-DD/`（以创建日期为准，跨天不移动）

```markdown
# Thread: [主题名]

**创建时间**：YYYY-MM-DD HH:MM
**最后更新**：YYYY-MM-DD HH:MM
**轮次**：[N] 轮
**当前状态**：🔄 活跃 / ✅ 已收敛 / ⏸️ 等待外部输入

## 思考轨迹（每轮更新）
1. [MM-DD HH:MM] 一句话洞见
2. [MM-DD HH:MM] 一句话洞见
...

## 当前结论
[最新一轮的核心结论，随每轮更新覆盖]

## 下一步行动
- [ ] ...

---

## 第 1 轮 — YYYY-MM-DD HH:MM
**功能**：[自我叙事/创造力暗室/CEO模拟 等]
**来源**：[📚/🧠/💡/🔄]

[正文内容]

**本轮洞见**：[一句话]

---

## 第 2 轮 — YYYY-MM-DD HH:MM（继续深化）
**承接**：上轮结论是 [...]，本轮追问 [...]

[新内容]

**本轮洞见**：[一句话]
```

### 何时用 Thread vs 独立笔记

| 条件 | 动作 |
|------|------|
| 情形 B（继续深化）+ 与上轮同主题 | **追加到** 已有 Thread File |
| 情形 A + 与某个活跃 Thread 相关 | **追加到** 该 Thread File |
| 全新主题 | **新建** Thread File |
| 纯粹碎片灵感（不够成 Thread） | 写独立 fleeting note |

### 跨天续接

Thread File 物理位置不变（留在创建日期的目录下）。跨天续接时，新一轮的时间戳标注为新的日期，但追加到同一个文件：

```markdown
## 第 8 轮 — 2026-02-23 02:00（跨天续接）
**承接**：昨天第 7 轮的结论是 [...]
```

### 收敛规则

**不限制轮次数量**。只在以下条件下收敛：

| 条件 | 动作 |
|------|------|
| 新一轮洞见与上轮**外行无法区分** | 🔴 反刍，触发 TPN 门控，Thread 标记 ⏸️ |
| 结论已足够清晰 + 行动项已明确 | 🟢 自然收敛，标记 ✅ |
| 需要外部输入才能继续（如用户反馈、数据） | 🟡 标记 ⏸️ 等待外部输入 |
| 累计 ≥ 10 轮且仍在前进 | 💡 **建议**（不强制）产出阶段性总结更新到「当前结论」 |

---

## TPN 门控机制（🆕 防止反刍循环）

**模拟大脑 TPN（任务正向网络）与 DMN 的拮抗关系**——DMN 负责漫游思考，TPN 负责执行行动。两者不能同时激活。

### 触发条件

每次产出后执行 TPN 门控检查：

| 检测 | 判定 | 动作 |
|------|------|------|
| 新一轮的核心洞见与上一轮**实质不同** | ✅ 在前进 | 放行，继续 DMN |
| 新一轮的核心洞见与上一轮**实质相同** | 🔴 在反刍 | 停止 DMN，切换到 TPN 模式 |
| Session Synthesis 的行动计划连续 2 次未完成 | 🔴 执行断裂 | 产出障碍分析（而非继续深化） |
| 本轮洞见可在 10 分钟内执行 | 🟡 Quick Win | 在 Synthesis 中标注 ⚡ Quick Win |

### TPN 模式输出：Action Card

当 TPN 门控触发时，不再产出思考笔记，改为产出 Action Card：

```markdown
## ⚡ Action Card — [标题]

- **What**：一句话描述做什么
- **How**：3 步以内，每步 < 5 分钟
- **Where**：在哪个平台/工具上执行
- **Done Criteria**：怎么算「做完了」
- **来源 Thread**：[[Thread_xxx]]（如适用）
```

Action Card 自动写入 `dmn-state.json` 的 `pendingActions`。

---

## 产出质量分级

每篇 DMN 产出（Thread 的每一轮 / 独立笔记）末尾必须自评一个质量等级：

| 等级 | 标准 | 后续动作 |
|------|------|----------|
| ⭐⭐⭐ **突破** | 产生了之前不存在的新连接或新框架 | 标记为候选入网笔记，情形 B 优先深化 |
| ⭐⭐ **推进** | 在已有方向上前进了一步，有新论据或新角度 | 正常归档 |
| ⭐ **重复** | 换了说法但核心洞见未变 | 触发 TPN 门控 |

**规则**：连续 2 个 ⭐ → 自动触发 TPN 门控。

在 `dmn-state.json` 中追踪质量趋势：
```json
"qualityLog": [
  {"time": "02:00", "level": 3, "topic": "准备陷阱", "thread": "Thread_方法论输出"},
  {"time": "03:00", "level": 1, "topic": "为什么没发", "thread": null}
]
```

---

## 衰减窗口机制

DMN 连续运行时间与产出模式的关系：

| 运行时段 | 模式 | 允许产出 |
|----------|------|----------|
| 0-2 小时 | **深度漫游** | 完整 Thread / fleeting note / CEO 模拟 |
| 2-4 小时 | **精炼模式** | 仅 Thread 追加 + Session Synthesis 更新 + Quick Win 标注 |
| 4+ 小时 | **休眠准备** | 仅产出**晨间简报**，然后进入 2 小时冷却 |

**4 小时硬上限**：连续运行 4 小时后，强制进入 2 小时冷却期。冷却期内只做一件事：写晨间简报（聚合本轮所有产出）。

---

## 反重复机制

**每次 DMN 启动时，必须先执行反重复检查**：

1. 读取今日 CEO思考 目录的所有文件名
2. 提取关键词
3. 如果某关键词出现 **≥ 2 次** → 该主题标记为"已饱和"，本次禁止新建独立笔记（但可追加到已有 Thread）
4. 如果所有主题都已饱和 → **强制切换到创造力暗室**，用远距离领域的旧笔记强制跨域

**同时检查**：
- 读取上一次 Session Synthesis：`未解问题`（优先起点）、`不要再问`（跳过列表）
- 检查 `pendingActions`：未完成的行动项是否需要跟进

---

## 不遗忘机制（🆕 三层保障）

### 层 1：晨间简报 → memory 写入（强制）

晨间简报产出后，**必须**将以下内容写入 `memory/YYYY-MM-DD.md`：

```markdown
### 待处理资产（来自 DMN）
- [ ] 📝 [描述] → `[文件路径]`
- [ ] 🔗 [描述]

### DMN 行动项
- [ ] [P0 行动项]
- [ ] [P1 行动项]
```

### 层 2：pendingActions 追踪

在 `dmn-state.json` 的 `pendingActions` 中记录：

```json
{
  "action": "发布准备陷阱文章",
  "createdAt": "2026-02-23T05:00",
  "source": "CEO思考/2026-02-23/20260223_创造力暗室_第一篇文章草稿.md",
  "priority": "P0",
  "reminderCount": 0,
  "maxReminders": 3,
  "status": "pending"
}
```

**规则**：
- 每次 DMN 运行，先检查 `pendingActions`
- 未完成的 P0 项 → 在 Synthesis 中**置顶提醒**
- 提醒 3 次仍未完成 → 标记 `abandoned`，写入 Synthesis 的「主动放弃」段落
- 昀峤说「做了」→ 标记 `completed`

### 层 3：Session Synthesis 资产清单

Session Synthesis 中增加「资产清单」段落（详见下方 Synthesis 格式）。

---

## Session Synthesis 格式

**每次 DMN 产出后，必须写一个 Session Synthesis**：

文件名：`YYYYMMDD_DMN_Synthesis_HHMM.md`

```markdown
## DMN Session Synthesis — [时间]

**本次使用**：[功能名] × [CEO名/随机笔记名]（如适用）
**三大目标关联**：[Agent协作/北美老年AI/方法论输出]
**活跃 Thread**：[[Thread_xxx]]（如适用）

### ⚡ 未完成提醒（来自 pendingActions）
- [ ] [P0 行动项]（已提醒 N 次）

### 本轮资产（DMN 已做好，拿去用）
- 📝 [描述]：`[路径]`（状态：待发布/待验证）

### 想清楚了
[1-2 句话：这次思考真正推进了什么]

### 行动计划
- [ ] [具体可执行，带预期时间]

### 未解问题
[1 个留给下次 DMN 的问题——这是下次的优先起点]

### 不要再问
[1-2 个已饱和主题，下次跳过]
```

**这个文件是下次 DMN 的第一个输入**。

---

## 完整执行流程（情形 A / 情形 B）

详见 **references/execution-flow.md**：Step 0（读取 Synthesis + 活跃 Thread）→ Step 1–9（反重复、衰减窗口、向内漫游、功能选择、产出、TPN 门控、Synthesis、不遗忘、通知、触发日志）；情形 B 为追加到 Thread + 更新 Synthesis + 不遗忘 + 写触发日志。

---

## 外部锚点机制（防止反刍循环）

### A. 昀峤主动提问（可选）

昀峤可在任意时刻留下问题：
> "今晚想想：北美老年产品的定价逻辑"

写入 `HEARTBEAT.md` 的 `今晚 DMN 问题` 字段。**可选，非必须。**

### B. DMN 自生成问题（默认机制）

如果 `今晚 DMN 问题` 为空，DMN 在 Step 3 后自动执行：

1. 统计三大战场近 48 小时的 note 数量
2. 找出**最久未深入思考**的战场
3. 从 CEO 轮换表选一位契合该战场的 CEO
4. 自动生成问题：`[CEO名]视角：关于[该战场]，今晚最值得探索的问题是什么？`
5. 以此问题作为本轮锚点

### 关于锚点与创意的关系

问题是**起点**，不是**边界**。有锚点的 DMN 反而比无锚点的更自由——可以从起点出发向任意方向延伸。真正限制创意的是**无输入的闭环**，而不是有方向的起点。

---

## 身份保护规则

**最高优先级**：
- **禁止直接修改 SOUL.md**
- 如有 SOUL.md 更新建议 → 写入 `~/.openclaw/workspace/PROPOSED_CHANGES.md`
- 由昀峤审阅后手动执行

---

## 产出规则

1. **目录**：`CEO思考/YYYY-MM-DD/`
2. **Thread 命名**：`YYYYMMDD_Thread_[主题].md`
3. **独立笔记命名**：`YYYYMMDD_[功能名]_[标题].md`
4. **链接**：每个 note/Thread 轮次至少链接到 1 个已有笔记
5. **关联索引**（必选其一）：
   - [[索引_三大目标_Agent协作落地]]
   - [[索引_三大目标_北美老年AI]]
   - [[索引_三大目标_方法论输出]]
6. **Synthesis**：每次情形 A 必须产出 Synthesis；情形 B 更新当日最新 Synthesis
7. **不遗忘写入**：每次产出后执行 memory + pendingActions 写入
8. **透明化标注**：每个 DMN 产出文件末尾加一行 `> 🤖 DMN Autonomous Output - [时间]`

---

## dmn-state.json 格式

存放于思考目录下的 `dmn-state.json`。必选字段：`lastCEO`、`lastCEOTimestamp`、`lastSynthesisFile`、`todaySaturatedTopics`、`tonightQuestion`、`continuousRunHours`、`qualityLog`、`pendingActions`、`activeThreads`。完整 schema 与示例见 **references/dmn-state-schema.md**。

---

## 三大目标索引

- [[索引_三大目标_Agent协作落地]] - Agent 协作从手动到自动
- [[索引_三大目标_北美老年AI]] - 北美老年+AI 产品
- [[索引_三大目标_方法论输出]] - AI 原生一人公司方法论

| 功能 | 推荐关联目标 |
|------|-------------|
| 自我叙事 | 任意 |
| 创造力暗室 | 任意（强制跨域） |
| 社会认知 | 任意 |
| 意义生成 | 任意 |
| **CEO思维模拟** | **根据 CEO 框架与战场匹配选** |

---

## 验收标准

- [ ] 被触发时立即执行（不自行判断用户活动）
- [ ] 情形 A 执行完整流程
- [ ] 情形 B 追加到 Thread（不新建文件）
- [ ] 每次产出必须有 Session Synthesis
- [ ] Thread 跨天续接正常工作（Step 0 扫描最近 3 天）
- [ ] 反重复检查生效（饱和主题不重复写）
- [ ] CEO 48 小时内不重复
- [ ] TPN 门控：反刍时停止思考，产出 Action Card
- [ ] TPN 门控：纵深推演时不打断（洞见不同即放行）
- [ ] 质量自评每轮执行
- [ ] 衰减窗口：4 小时后仅写晨间简报
- [ ] 不遗忘：晨间简报 → memory 写入
- [ ] 不遗忘：pendingActions 追踪生效
- [ ] 不遗忘：P0 未完成项在 Synthesis 置顶
- [ ] 飞书通知发 Synthesis 而不是文件列表
- [ ] 身份保护生效
- [ ] 铁律全部遵守

- [ ] 触发日志每次 cron 都写入

---

*v3.1.0 — 开源版 | Thread File / TPN 门控 / 不遗忘机制 / 跨天续接 / 铁律体系 / 质量分级 / 衰减窗口 / 触发日志*
